<!DOCTYPE html>
<html lang="pt-BR" data-theme="system">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tutorial de instala√ß√£o do Nextflow ‚Äî Guias</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="/assets/css/guides.css" />
  <link
    rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üß¨</text></svg>"/>
</head>
<body><!-- HEADER -->
  <header>
    <div class="container nav">
      <a class="brand" href="/" aria-label="P√°gina inicial">
        <span class="logo">üß¨</span>
        <strong>Christopher William Lee</strong>
      </a>
      <nav class="links" aria-label="Navega√ß√£o prim√°ria">
        <a href="/#projetos">Projetos</a>
        <a href="/#publicacoes">Publica√ß√µes</a>
        <a href="/#sobre">Sobre</a>
        <a href="/#contato">Contato</a>
        <a href="/guias/"
           class=""
           >Guias</a>
        <button class="theme-toggle" id="themeBtn" title="Alternar tema">üåó</button>
      </nav>
    </div>
  </header>

  <!-- CONTE√öDO -->
  <main class="container">
    <section class="guides-shell">
      <!-- SIDEBAR -->
      <aside class="sidebar" aria-label="√çndice dos guias">
        <details class="side-group" open>
          <summary>Ferramentas</summary>
          <a href="/guias/ferramentas/kraken2/" class="side-item ">Kraken2</a>
          <a href="/guias/ferramentas/qiime2/" class="side-item ">QIIME2</a>
          <a href="/guias/ferramentas/biobakery/" class="side-item ">BioBakery</a>
          <a href="/guias/ferramentas/sra_tools/" class="side-item ">SRA-Tools</a>
          <a href="/guias/ferramentas/git/" class="side-item ">Git</a>
          <a href="/guias/ferramentas/github/" class="side-item ">Github</a>
          <a href="/guias/ferramentas/fastp/" class="side-item ">FASTP</a>
        </details>

        <details class="side-group" open>
          <summary>Aparadores</summary>
          <a href="/guias/aparadores/trimgalore/" class="side-item ">Trimgalore</a>
          <a href="/guias/aparadores/trimmomatic/" class="side-item ">Trimmomatic</a>
        </details>

        <details class="side-group">
          <summary>Ambientes e workflow</summary>
          <a href="/guias/ambientes/anaconda/" class="side-item ">Anaconda</a>
          <a href="/guias/ambientes/snakemake/" class="side-item ">Snakemake</a>
          <a href="/guias/ambientes/nextflow/" class="side-item active">Nextflow</a>
          <a href="/guias/ambientes/docker/" class="side-item ">Docker</a>
        </details>

        <details class="side-group">
          <summary>Conversor de arquivos</summary>
          <a href="/guias/conversores/bcl2fastq/" class="side-item ">BCL2fastq</a>
        </details>

        <details class="side-group">
          <summary>Plataforma</summary>
          <a href="/guias/plataforma/wsl/" class="side-item ">WSL</a>
        </details>

        <details class="side-group">
          <summary>Qualidade de dados</summary>
          <a href="/guias/qualidade/fastqc/" class="side-item ">FASTQC</a>
          <a href="/guias/qualidade/falco/" class="side-item ">FALCO</a>
          <a href="/guias/qualidade/multiqc/" class="side-item ">MULTIQC</a>
        </details>

        <details class="side-group">
          <summary>Meus projetos</summary>
          <a href="/guias/meus_projetos/google_sheets/" class="side-item ">Google Sheets</a>
        </details>

        <details class="side-group">
          <summary>Bitcoin</summary>
          <a href="/guias/bitcoin/bluewallet/" class="side-item ">Bluewallet</a>
        </details>
      </aside>


      <!-- CONTE√öDO DO MARKDOWN -->
      <section class="reader" id="reader">
        <h1>Tutorial de instala√ß√£o do Nextflow</h1>
        <p><img src="/assets/img/nextflow/nextflow_logo.png" alt="Nextflow logo" /></p>

<h1 id="instala√ß√£o-do-nextflow--primeiro-workflow-fastqc"><u>Instala√ß√£o do Nextflow + primeiro workflow (FastQC)</u></h1>

<p>
  Fala, galera! Bora colocar o
  <a href="https://www.nextflow.io/" target="_blank">
    <span class="tooltip">Nextflow
      <span class="tooltiptext">Plataforma para criar e executar workflows cient√≠ficos.</span>
    </span>
  </a>
  pra rodar? <br /><br />
  Se voc√™ trabalha com bioinform√°tica, cedo ou tarde vai querer
  <span class="tooltip">automatizar suas an√°lises
    <span class="tooltiptext">Organizar as etapas em um fluxo √∫nico, sem rodar comandos soltos manualmente.</span>
  </span>.  
  O <span class="badge badge--nextflow">Nextflow</span> √© aquele
  <span class="tooltip">motor de workflow
    <span class="tooltiptext">Um sistema que conecta etapas de an√°lise, controla depend√™ncias e executa em ordem.</span>
  </span>
  que liga suas etapas,
  <span class="tooltip">paraleliza
    <span class="tooltiptext">Executa v√°rias etapas ao mesmo tempo, aproveitando m√∫ltiplos n√∫cleos da CPU.</span>
  </span>,
  cuida de
  <span class="tooltip">arquivos tempor√°rios
    <span class="tooltiptext">Arquivos intermedi√°rios criados entre etapas, descartados automaticamente quando n√£o s√£o mais necess√°rios.</span>
  </span>
  e deixa tudo <strong>reprodut√≠vel</strong> e <strong>organizado</strong>, seja no seu notebook, no WSL, em servidores ou na nuvem.
</p>

<p><u>Neste guia, voc√™ vai:</u></p>

<ul>
  <li>Instalar o <span class="badge badge--nextflow">Nextflow</span> rapidinho (WSL/Linux/macOS);</li>
  <li>Entender o que √© um workflow;</li>
  <li>Criar <strong>seu primeiro pipeline</strong> usando o <strong>FastQC</strong> como exemplo.</li>
</ul>

<p><img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbnh2ajFvdjRrZXMwbzlsb3RqaTYwaXVjMXo2cndjZnVjZTRyeXd3cSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/nn8uzAnxuchf2OWXNy/giphy.gif" alt="Anima√ß√£o ilustrando um pipeline encadeado (workflow) rodando" width="200" style="display:block; margin:auto;" /></p>

<p><code class="codeStyle">
  A ideia √© essa: cada etapa √© um <em>passo</em> e o Nextflow coordena tudo.
</code></p>

<hr />

<h1 id="o-que-√©-o-nextflow">O que √© o Nextflow?</h1>

<p>
  O <a href="https://www.nextflow.io/" target="_blank">Nextflow</a> √© um 
  <span class="tooltip">gerenciador de workflows
    <span class="tooltiptext">Programa que organiza e executa v√°rias etapas de uma an√°lise cient√≠fica.</span>
  </span>
  criado especialmente para dados cient√≠ficos e bioinform√°tica.
</p>

<ul>
  <li>
    Em vez de rodar comandos soltos no terminal, voc√™ descreve cada etapa como um 
    <span class="tooltip"><strong>processo</strong>
      <span class="tooltiptext">Bloco que executa uma tarefa (ex.: rodar o FastQC) com script, recursos e, se quiser, container.</span>
    </span>.
  </li>
  <li>
    Os dados circulam por 
    <span class="tooltip"><strong>canais</strong>
      <span class="tooltiptext">Fluxos que carregam valores/arquivos entre processos, garantindo a ordem correta.</span>
    </span>; cada processo declara seus 
    <span class="tooltip"><em>inputs</em>
      <span class="tooltiptext">Arquivos/valores de entrada (ex.: FASTQ bruto).</span>
    </span> e 
    <span class="tooltip"><em>outputs</em>
      <span class="tooltiptext">Arquivos/valores de sa√≠da (ex.: relat√≥rio de qualidade).</span>
    </span>. O <span class="badge badge--nextflow">Nextflow</span> conecta tudo automaticamente formando um 
    <span class="tooltip"><a href="https://nextflow.io/docs/latest/developer/nextflow.dag.html" target="_blank"><em>DAG</em></a>
      <span class="tooltiptext">Grafo Ac√≠clico Direcionado: representa as etapas (n√≥s) e suas depend√™ncias (arestas) sem ciclos.</span>
    </span> do pipeline.

  </li>
  <li>
    Ele executa etapas em 
    <span class="tooltip">paralelo
      <span class="tooltiptext">Aproveita v√°rios n√∫cleos/recursos conforme depend√™ncias permitem.</span>
    </span>, economiza tempo e permite trocar facilmente o 
    <span class="tooltip"><strong>ambiente de execu√ß√£o</strong>
      <span class="tooltiptext">Local (seu computador), Conda, Docker/Singularity, HPC ou nuvem.</span>
    </span>.
  </li>
  <li>
    √â focado em 
    <span class="tooltip"><strong>reprodutibilidade</strong>
      <span class="tooltiptext">Mesma an√°lise, mesmos resultados, em qualquer ambiente.</span>
    </span> e 
    <span class="tooltip"><strong>portabilidade</strong>
      <span class="tooltiptext">Mesmo pipeline roda em diferentes m√°quinas sem reescrita.</span>
    </span>. Possui cache de resultados e o famoso 
    <code style="background:#2d2d2d; border-radius:6px; padding:2px 6px;">-resume</code>, que reaproveita etapas j√° conclu√≠das.
  </li>
</ul>

<hr />

<h2 id="passo-a-passo">Passo a passo</h2>
<ol>
  <li><a href="#instalacao">Instala√ß√£o</a></li>
  <li><a href="#workflow">Seu primeiro workflow (FastQC)</a></li>
  <li><a href="#explicacao-do-codigo">Explica√ß√£o do c√≥digo</a></li>
</ol>

<hr />

<h2 id="instalacao">1. Instalando o Nextflow</h2>

<p>
  Antes de instalar o <span class="badge badge--nextflow">Nextflow</span>, precisamos do 
  <span class="tooltip"><strong>Java</strong>
    <span class="tooltiptext">Linguagem de programa√ß√£o usada pelo <span class="badge badge--nextflow">Nextflow</span> para funcionar.</span>
  </span>. 
  A vers√£o m√≠nima √© o Java 11, mas recomendo usar o <strong>Java 17</strong> para maior compatibilidade.
</p>

<blockquote class="info">
  Se voc√™ j√° tiver o Java 11 ou 17 instalado, pode pular este passo.
  Para verificar, rode no terminal:
  <pre>java -version</pre> 
</blockquote>

<h3>1.1 Instalando o Java (WSL/Ubuntu)</h3>

<p>No WSL/Ubuntu, execute:</p>
<pre>sudo apt update
sudo apt install -y openjdk-17-jre</pre>

<p>Verifique a instala√ß√£o:</p>
<pre>java -version</pre>

<p>Sa√≠da esperada (algo como):</p>
<p><code style="display:inline-block; background:#2d2d2d; color:#e1e1e1; border-radius:6px; padding:8px 12px; white-space:pre; line-height:1.4;">openjdk version "17.x.x" 2025-XX-XX
OpenJDK Runtime Environment (build 17.0.x+XX-Ubuntu-XX)
OpenJDK 64-Bit Server VM (build 17.0.x+XX-Ubuntu-XX, mixed mode, sharing)
</code></p>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Comando</th>
        <th>Descri√ß√£o</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="codeStyle">sudo apt update</code></td>
        <td>Atualiza a lista de pacotes dispon√≠veis no Ubuntu.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">sudo apt install -y openjdk-17-jre</code></td>
        <td>Instala o Java 17 (JRE). A flag <code class="codeStyle">-y</code> confirma automaticamente.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">java -version</code></td>
        <td>Mostra a vers√£o instalada do Java (para confirmar que deu certo).</td>
      </tr>
    </tbody>
  </table>
</div>

<h3>1.2 Instalando o Nextflow</h3>

<p>
  Agora que j√° temos o Java, podemos instalar o <span class="badge badge--nextflow">Nextflow</span>. 
  A forma mais pr√°tica √© via um script oficial que baixa o bin√°rio pronto.
</p>

<p>Rode no terminal:</p>
<pre>curl -s https://get.nextflow.io | bash</pre>

<p>
  Isso gera um arquivo chamado <span class="badge badge--nextflow">Nextflow</span> no diret√≥rio atual.
  Para deixar dispon√≠vel em qualquer lugar do sistema, mova-o para uma pasta do seu <em>PATH</em> (ex.: <code class="codeStyle">~/bin</code>):
</p>

<pre>mkdir -p ~/bin
mv nextflow ~/bin/
echo 'export PATH="$HOME/bin:$PATH"' &gt;&gt; ~/.bashrc
source ~/.bashrc</pre>

<p>Teste para ver se funcionou:</p>
<pre>nextflow -version</pre>

<p>Sa√≠da esperada (algo como):</p>
<p><code style="display:inline-block; background:#000000; color:#e1e1e1; border-radius:6px; padding:5px 12px; white-space:pre; line-height:1.4;">N E X T F L O W
version 25.04.6 build 5954
created 01-07-2025 11:27 UTC (08:27 BRST)
cite doi:10.1038/nbt.3820
http://nextflow.io
</code></p>

<blockquote class="tip">
  Se voc√™ j√° usa o <span class="badge badge--nextflow">conda</span>, tamb√©m pode instalar o <span class="badge badge--nextflow">Nextflow</span> assim:<br />
   <pre>conda install -c bioconda -c conda-forge nextflow</pre>
  <blockquote class="warning">
    Essa op√ß√£o √© pr√°tica, mas a instala√ß√£o via script oficial costuma ser mais est√°vel em ambientes mistos (local, HPC, nuvem).
  </blockquote>
</blockquote>

<blockquote class="info">
  <strong>Observa√ß√£o:</strong> Se voc√™ usa <code class="codeStyle">zsh</code> em vez de <code class="codeStyle">bash</code>, substitua <code class="codeStyle">~/.bashrc</code> por <code class="codeStyle">~/.zshrc</code> ao ajustar o <em>PATH</em>.
  Para atualizar o <span class="badge badge--nextflow">Nextflow</span> no futuro: <code class="codeStyle">nextflow self-update</code>.
</blockquote>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Comando</th>
        <th>Descri√ß√£o</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="codeStyle">curl -s https://get.nextflow.io | bash</code></td>
        <td>Baixa e executa o instalador oficial do <span class="badge badge--nextflow">Nextflow</span>.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">mkdir -p ~/bin</code></td>
        <td>Cria a pasta <code class="codeStyle">~/bin</code> se n√£o existir.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">mv nextflow ~/bin/</code></td>
        <td>Move o execut√°vel <code class="codeStyle">nextflow</code> para <code class="codeStyle">~/bin</code>.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">echo 'export PATH="$HOME/bin:$PATH"' &gt;&gt; ~/.bashrc</code></td>
        <td>Adiciona <code class="codeStyle">~/bin</code> ao <em>PATH</em> de forma permanente (para bash).</td>
      </tr>
      <tr>
        <td><code class="codeStyle">source ~/.bashrc</code></td>
        <td>Recarrega o arquivo de configura√ß√£o para ativar o <em>PATH</em> atualizado.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">nextflow -version</code></td>
        <td>Verifica se o <span class="badge badge--nextflow">Nextflow</span> foi instalado corretamente.</td>
      </tr>
    </tbody>
  </table>
</div>

<h2 id="workflow">2. Seu primeiro workflow (FastQC)</h2>

<p>
  Agora que o <span class="badge badge--nextflow">Nextflow</span> est√° instalado, vamos criar o nosso
  <span class="tooltip">primeiro workflow
    <span class="tooltiptext">Um encadeamento de etapas automatizadas para processar dados.</span>
  </span>.  
  Vamos usar o <strong>FastQC</strong>, que gera relat√≥rios de qualidade de arquivos FASTQ.
</p>

<blockquote class="info">
Se voc√™ nunca instalou o FASTQC, voc√™ pode acessar o tutorial aqui: <a href="/guias/qualidade/fastqc" target="_blank">Tutorial FASTQC</a>
</blockquote>

<h3>2.1 Criando a estrutura do projeto</h3>

<p>Crie uma pasta para o workflow e um diret√≥rio de dados:</p>
<pre>mkdir -p ~/nextflow_tutorial
cd ~/nextflow_tutorial</pre>

<h3>2.1.1 Ambiente isolado + download da SRA (recomendado)</h3>

<p style="align-text: justify">
  Antes de escrever o c√≥digo, vamos preparar o ambiente que vai rodar o pipeline.  
  Em vez de instalar ferramentas direto no sistema, vamos criar um <strong>ambiente</strong>
  <a href="/guias/ferramentas/sra_tools/" target="_blank">
    <span class="tooltip">Conda
      <span class="tooltiptext">Tutorial Conda.</span>
    </span>
  </a>
  exclusivo com o <strong>FastQC</strong> e o 
  <a href="/guias/ferramentas/sra_tools/" target="_blank">
    <span class="tooltip">SRA-Tools
      <span class="tooltiptext">Tutorial SRA-Tools.</span>
    </span>
  </a>.  
  Isso garante isolamento, evita conflitos de vers√£o e deixa o projeto reprodut√≠vel.
</p>

<pre>conda create -n nf-fastqc-sra -c bioconda -c conda-forge fastqc sra-tools -y
conda activate nf-fastqc-sra</pre>

<blockquote class="info">
  Esse passo √© recomendado porque:<br />
  ‚Ä¢ mant√©m o ambiente do sistema limpo;<br />
  ‚Ä¢ garante que todos os usu√°rios ter√£o as mesmas vers√µes das ferramentas;<br />
  ‚Ä¢ facilita a repeti√ß√£o do pipeline em qualquer m√°quina.
</blockquote>

<p style="align-text: justify">
  O pipeline do pr√≥ximo passo (<strong><a href="#nextflow_tut.nf">2.2 Criando o arquivo nextflow_tut.nf</a></strong>) aceita <em>duas formas de entrada</em>:
  voc√™ pode <strong>baixar uma amostra do SRA</strong> informando <code class="codeStyle">--srr &lt;SRR_ID&gt;</code> (ex.: <code class="codeStyle">SRR34840432</code>)
  <em>ou</em> usar <strong>seus pr√≥prios FASTQs locais</strong> com <code class="codeStyle">--fastq &lt;DIR&gt;</code> (padr√£o de arquivos <code class="codeStyle">*_1.fastq.gz</code> e <code class="codeStyle">*_2.fastq.gz</code>).
  Esses modos s√£o <strong>mutuamente exclusivos</strong>, <strong style="color: red">escolha apenas um por execu√ß√£o</strong>, permitindo decidir na hora se vai trabalhar com dados p√∫blicos do SRA ou com arquivos que voc√™ j√° possui.
</p>

<blockquote class="tip">
  Dessa forma, voc√™ pode trocar facilmente o n√∫mero de acesso sem editar o c√≥digo. Basta rodar o comando acima com outro <code class="codeStyle">SRR</code>.
</blockquote>

<h3>2.1.2 Preparando os dados (FASTQ local)</h3>

<p>Se voc√™ j√° tem FASTQs locais, coloque-os em <code class="codeStyle">data/</code> no padr√£o <code class="codeStyle">*_1.fastq.gz</code> e <code class="codeStyle">*_2.fastq.gz</code>:</p>
<pre>mkdir -p data
# copie ou mova seus arquivos *_1.fastq.gz e *_2.fastq.gz para data/</pre>

<blockquote class="info">
  O pipeline exige arquivos <code class="codeStyle">.fastq.gz</code> pareados.  
  Se estiverem descompactados (<code class="codeStyle">.fastq</code>), compacte:
</blockquote>
<pre>gzip data/*_1.fastq data/*_2.fastq</pre>

<h3 id="nextflow_tut.nf">2.2 Criando o arquivo nextflow_tut.nf</h3>

<p>Esse ser√° o ‚Äúcora√ß√£o‚Äù do pipeline. Crie:</p>

<pre>nano nextflow_tut.nf</pre>

<blockquote class="info">
  O nextflow_tut.nf √© o arquivo principal do <span class="badge badge--nextflow">Nextflow</span>.  
  √â nele que voc√™ descreve os
  <span class="tooltip">processos
    <span class="tooltiptext">Blocos de c√≥digo que executam uma tarefa espec√≠fica (ex.: rodar o FastQC).</span>
  </span>,
  os
  <span class="tooltip">canais
    <span class="tooltiptext">Caminhos de dados que ligam a sa√≠da de um processo √† entrada de outro.</span>
  </span>
  e o
  <span class="tooltip">workflow
    <span class="tooltiptext">Sequ√™ncia l√≥gica que conecta todos os processos.</span>
  </span>.  
  O nextflow_tut.nf funciona como o roteiro do pipeline: nele voc√™ define quais dados entram (inputs) e quais etapas de an√°lise devem ser executadas (processos), al√©m de como esses passos se conectam.
</blockquote>

<p>Cole o conte√∫do abaixo:</p>

<pre>
// nextflow_tut.nf ‚Äî pipeline com SRA + FastQC
// DSL2
nextflow.enable.dsl=2

// -------------------- Par√¢metros --------------------
params.srr    = null
params.fastq  = null
params.outdir = null
params.help   = false

// -------------------- Ajuda --------------------
def helpMessage() {
    log.info """
    ======================================================
     Pipeline Nextflow: Download SRA + FastQC
    ======================================================
    Uso:
      nextflow run nextflow_tut.nf --fastq &lt;dir&gt; --outdir &lt;dir&gt;
      nextflow run nextflow_tut.nf --srr &lt;SRR&gt;   --outdir &lt;dir&gt;

    Par√¢metros:
      --fastq   Diret√≥rio com FASTQs (espera *_1.fastq.gz e *_2.fastq.gz)
      --srr     Acess√£o SRA (ex.: SRR34840432)
      --outdir  Sa√≠da do FastQC
      --help    Mostra esta mensagem
    """
}

if (params.help) { helpMessage(); System.exit(0) }

// -------------------- Utils --------------------
// Verifica se existem pares *_1.fastq.gz e *_2.fastq.gz no diret√≥rio
def requireGzipPairs(String dirPath) {
  def dir = new File(dirPath)
  if (!dir.exists() || !dir.isDirectory())
    error "Diret√≥rio n√£o encontrado: ${dirPath}"

  def names = (dir.listFiles() ?: [])
      .collect { it.name }
      .findAll { it ==~ /.+_(1|2)\.fastq\.gz$/ }

  if (!names || names.isEmpty())
    error "Os arquivos t√™m que estar compactados (.fastq.gz) no padr√£o *_1.fastq.gz e *_2.fastq.gz em ${dirPath}."

  def bases = names.collect { it.replaceFirst(/_(1|2)\.fastq\.gz$/, '') }.unique()
  def hasPair = bases.any { base -&gt;
    new File(dir, "${base}_1.fastq.gz").exists() &amp;&amp; new File(dir, "${base}_2.fastq.gz").exists()
  }

  if (!hasPair)
    error "Arquivos .fastq.gz encontrados, mas **sem par** correspondente *_1/_2 em ${dirPath}."

  return true
}

// -------------------- Processos --------------------

// 1) Prefetch (cache local do SRA); emite apenas o SRR para o pr√≥ximo passo
process DOWNLOAD_SRA {
  // R√≥tulo da tarefa com o ID da amostra (srr) de --srr (SRA) ou do par FASTQ (local)
  tag "${srr}"

  input:
  val srr

  output:
  val srr

  script:
  """
  prefetch ${srr}
  """
}

// 2) Converter SRA -&gt; FASTQ(.gz) com fasterq-dump
process SRA_TO_FASTQ {
  tag "${srr}"

  input:
  val srr

  output:
  tuple val(srr), path("${srr}_*.fastq.gz")

  script:
  """
  # Gera FASTQs e compacta
  fasterq-dump ${srr} -O . --split-files
  pigz -f ${srr}_1.fastq || gzip -f ${srr}_1.fastq
  pigz -f ${srr}_2.fastq || gzip -f ${srr}_2.fastq || true
  """
}

// 3) FastQC ‚Äî recebe (srr, [R1,R2])
process FASTQC {
  tag "${srr}"

  publishDir { "${params.outdir}/${srr}" }, mode: 'copy', overwrite: true

  input:
  tuple val(srr), path(reads)

  output:
  path "*.html"
  path "*.zip"

  script:
  """
  fastqc -o . ${reads}
  """
}

// -------------------- Workflow --------------------
workflow {
  if (params.fastq) {
    log.info "Modo: FASTQ local"
    log.info "FASTQ dir: ${params.fastq}"

    // ---- Verifica√ß√£o de gzip ----
    requireGzipPairs(params.fastq as String)

    // S√≥ depois cria a channel:
    fastq_ch = Channel.fromFilePairs("${params.fastq}/*_{1,2}.fastq.gz")

    FASTQC(fastq_ch)
  }
  else if (params.srr) {
    log.info "Modo: SRA"
    log.info "Iniciando pipeline com SRR: ${params.srr}"

    srr_ch   = Channel.of(params.srr)
    cached   = DOWNLOAD_SRA(srr_ch)
    fastq_ch = SRA_TO_FASTQ(cached)

    FASTQC(fastq_ch)
  }
  else {
    error "Forne√ßa --fastq &lt;dir&gt; (FASTQ local) ou --srr &lt;ID&gt; (SRA). Use --help para ajuda."
  }
}
</pre>

<p>
  Esse pipeline est√° dividido em tr√™s partes principais: 
  <strong>par√¢metros e valida√ß√µes</strong>, 
  <strong>processos</strong> e o <strong>workflow</strong>.
</p>

<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Elemento</th>
        <th>Descri√ß√£o</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code class="codeStyle">params.fastq</code></td>
        <td>
          Diret√≥rio com FASTQs <code class="codeStyle">*.fastq.gz</code> pareados (<code class="codeStyle">*_1</code> e <code class="codeStyle">*_2</code>) para o modo local.
        </td>
      </tr>
      <tr>
        <td><code class="codeStyle">params.srr</code></td>
        <td>
          ID de acesso 
          <span class="tooltip"><strong>SRA</strong>
            <span class="tooltiptext">Sequence Read Archive: reposit√≥rio p√∫blico de leituras de sequenciamento.</span>
          </span> para o modo de download (SRA).
        </td>
      </tr>
      <tr>
        <td><code class="codeStyle">params.outdir</code></td>
        <td>Diret√≥rio de sa√≠da. Organiza os relat√≥rios do FastQC por amostra sem precisar editar o c√≥digo.</td>
      </tr>
      <tr>
        <td><code class="codeStyle">params.help</code></td>
        <td>Mostra a mensagem de uso (<code class="codeStyle">--help</code>) e encerra.</td>
      </tr>
      <tr>
        <td><strong>helpMessage()</strong></td>
        <td>Fun√ß√£o que centraliza o guia de uso dos dois modos (local e SRA).</td>
      </tr>
      <tr>
        <td><code class="codeStyle">requireGzipPairs(dir)</code></td>
        <td>
          Verifica√ß√£o no modo <code class="codeStyle">--fastq</code>: exige pares <code class="codeStyle">*.fastq.gz</code> (<code class="codeStyle">*_1</code> e <code class="codeStyle">*_2</code>);
          aborta se n√£o encontrar pares v√°lidos.
        </td>
      </tr>
      <tr>
        <td><code class="codeStyle">process DOWNLOAD_SRA</code></td>
        <td>
          Baixa o <code class="codeStyle">.sra</code> para o cache padr√£o e emite apenas <code class="codeStyle">val srr</code> para a pr√≥xima etapa
          (mant√©m cache entre execu√ß√µes).
        </td>
      </tr>
      <tr>
        <td><code class="codeStyle">process SRA_TO_FASTQ</code></td>
        <td>
          Converte <code class="codeStyle">.sra</code> em FASTQs com <code class="codeStyle">fasterq-dump --split-files</code>, compacta
          (<code class="codeStyle">pigz</code> ou <code class="codeStyle">gzip</code>) e emite uma 
          <span class="tooltip"><strong>tupla</strong>
            <span class="tooltiptext">Estrutura com m√∫ltiplos valores; aqui, o SRR + os arquivos gerados.</span>
          </span> 
          no formato <code class="codeStyle">(srr, &quot;${srr}_*.fastq.gz&quot;)</code>.
        </td>
      </tr>
      <tr>
        <td><code class="codeStyle">process FASTQC</code></td>
        <td>
          Recebe <code class="codeStyle">tuple val(srr), path(reads)</code> (lista com R1/R2), roda o FastQC e
          publica os relat√≥rios <code class="codeStyle">.html</code>/<code class="codeStyle">.zip</code> em <code class="codeStyle">${params.outdir}/${srr}</code>.
        </td>
      </tr>
      <tr>
        <td><em>Workflow</em></td>
        <td>
          Dois ramos equivalentes que convergem no <code class="codeStyle">FASTQC</code>:
          <br /><code class="codeStyle">--fastq</code>: <code class="codeStyle">fromFilePairs(&quot;data/*_{1,2}.fastq.gz&quot;)</code> ‚Üí <code class="codeStyle">FASTQC</code>
          <br /><code class="codeStyle">--srr</code>: <code class="codeStyle">Channel.of(srr)</code> ‚Üí <code class="codeStyle">DOWNLOAD_SRA</code> ‚Üí <code class="codeStyle">SRA_TO_FASTQ</code> ‚Üí <code class="codeStyle">FASTQC</code>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<h3>2.3 Executando o workflow (modo FASTQ local)</h3>

<p style="align-text: justify">Ao executar o comando, o pipeline identifica automaticamente os pares <code class="codeStyle">R1/R2</code> dentro de <code class="codeStyle">data/</code>, roda o processo <code class="codeStyle">FASTQC</code> para cada amostra detectada e, por fim, publica os relat√≥rios <code class="codeStyle">.html</code> e <code class="codeStyle">.zip</code> em <code class="codeStyle">results/&lt;amostra&gt;/</code>.</p>

<p>Ap√≥s criar o arquivo <code class="codeStyle">nextflow_tut.nf</code> no pr√≥ximo passo, execute:</p>
<pre>nextflow run nextflow_tut.nf --fastq data/ --outdir results/</pre>

<blockquote class="info">
  Este modo exige arquivos <code class="codeStyle">.fastq.gz</code> no padr√£o <code class="codeStyle">*_1.fastq.gz</code> e <code class="codeStyle">*_2.fastq.gz</code> dentro de <code class="codeStyle">data/</code>.  
</blockquote>

<h3>2.3 Conferindo a sa√≠da</h3>

<p>Voc√™ deve ver pastas por amostra dentro de <code class="codeStyle">results/</code>, contendo os relat√≥rios do FastQC. Exemplo:</p>
<pre>results/SRR34840432/SRR34840432_1_fastqc.html
results/SRR34840432/SRR34840432_2_fastqc.html</pre>

<h3>2.4 (Opcional) Rodar com SRA</h3>

<p>O pipeline tamb√©m suporta baixar direto do SRA. Use <code class="codeStyle">--srr</code> (sem <code class="codeStyle">--fastq</code>):</p>
<pre>nextflow run nextflow_tut.nf --srr SRR34840432 --outdir results/</pre>

<blockquote class="info">
  O pipeline executa, na ordem: <strong>DOWNLOAD_SRA</strong> ‚Üí <strong>SRA_TO_FASTQ</strong> ‚Üí <strong>FASTQC</strong>.<br />
  ‚Ä¢ Baixa o SRR com <code class="codeStyle">prefetch</code> (cache do SRA-Tools);<br />
  ‚Ä¢ Converte para <code class="codeStyle">_1.fastq.gz</code> e <code class="codeStyle">_2.fastq.gz</code> (<code class="codeStyle">fasterq-dump --split-files</code> + <code class="codeStyle">pigz</code> ou <code class="codeStyle">gzip</code>);<br />
  ‚Ä¢ Roda o <strong>FastQC</strong> e publica relat√≥rios <code class="codeStyle">.html</code>/<code class="codeStyle">.zip</code> em <code class="codeStyle">results/&lt;SRR&gt;/</code>.
</blockquote>

<p>O seu resultado deve ser parecido com isso:</p>
<p><img src="/assets/img/nextflow/nextflow_1.png" alt="Execu√ß√£o do Nextflow mostrando os processos do pipeline" /></p>

<blockquote class="tip">
  Dica: se voc√™ alternar par√¢metros e quiser reaproveitar etapas j√° feitas, use <code class="codeStyle">-resume</code>:
</blockquote>
<pre>nextflow run nextflow_tut.nf --fastq data/ --outdir results/ -resume</pre>

<p><strong>Quer salvar em outra pasta?</strong></p>
<pre>nextflow run nextflow_tut.nf --srr SRR34840432 --outdir results/meu_fastqc</pre>

<p><strong>Reaproveitar etapas j√° conclu√≠das:</strong></p>
<pre>nextflow run nextflow_tut.nf --fastq data/ --outdir results/ -resume</pre>

<p><strong>Ver a ajuda dos par√¢metros:</strong></p>
<pre>nextflow run nextflow_tut.nf --help</pre>

<h3>2.5 Erros comuns</h3>

<ul>
  <li>
    <strong>Sem pares .fastq.gz:</strong> Se seus arquivos n√£o est√£o compactados, o canal fica vazio e nada roda.  
    Compacte ou ajuste o padr√£o.
  </li>
</ul>

<hr />

<h2 id="explicacao-do-codigo">3. Explica√ß√£o do c√≥digo</h2>
<h3>3.1 Par√¢metros</h3>

<p style="text-align: justify">
  Aqui definimos as vari√°veis que controlam a execu√ß√£o do pipeline: 
  <code class="codeStyle">params.fastq</code> indica um diret√≥rio com FASTQs pareados, 
  <code class="codeStyle">params.srr</code> recebe um ID do SRA para download, 
  <code class="codeStyle">params.outdir</code> define onde salvar os relat√≥rios do FastQC
  e <code class="codeStyle">params.help</code> habilita a mensagem de ajuda. 
  Os modos <code class="codeStyle">--fastq</code> e <code class="codeStyle">--srr</code> ser√£o validados adiante como <em>mutuamente exclusivos</em>, 
  e todos os par√¢metros podem ser sobrescritos na linha de comando.
</p>

<pre>
// -------------------- Par√¢metros --------------------
params.srr    = null
params.fastq  = null
params.outdir = null
params.help   = false
</pre>

<h3>3.2 Ajuda</h3>

<p style="text-align: justify">
  A fun√ß√£o <strong><em>helpMessage()</em></strong> centraliza o guia de uso do pipeline. Ela imprime um banner
  com os dois modos de execu√ß√£o (usar FASTQs locais com <code class="codeStyle">--fastq &lt;dir&gt;</code> ou baixar do SRA com
  <code class="codeStyle">--srr &lt;SRR&gt;</code>), al√©m de listar os par√¢metros dispon√≠veis e seus prop√≥sitos. Quando o usu√°rio
  executa o script com <code class="codeStyle">--help</code>, o bloco <code class="codeStyle">if (params.help)</code> chama essa fun√ß√£o e finaliza
  a execu√ß√£o imediatamente com <code class="codeStyle">System.exit(0)</code>, garantindo que nenhuma etapa do pipeline seja
  iniciada por engano.
</p>

<pre>
// -------------------- Ajuda --------------------
def helpMessage() {
    log.info """
    ======================================================
     Pipeline Nextflow: Download SRA + FastQC
    ======================================================
    Uso:
      nextflow run nextflow_tut.nf --fastq &lt;dir&gt; --outdir &lt;dir&gt;
      nextflow run nextflow_tut.nf --srr &lt;SRR&gt;   --outdir &lt;dir&gt;

    Par√¢metros:
      --fastq   Diret√≥rio com FASTQs (espera *_1.fastq.gz e *_2.fastq.gz)
      --srr     Acess√£o SRA (ex.: SRR34840432)
      --outdir  Sa√≠da do FastQC
      --help    Mostra esta mensagem
    """
}

if (params.help) { helpMessage(); System.exit(0) }
</pre>

<h3>3.3 Utils</h3>

<p style="text-align: justify">
  A fun√ß√£o <code class="codeStyle">requireGzipPairs(dirPath)</code> faz uma verifica√ß√£o no modo
  <code class="codeStyle">--fastq</code> para garantir que existam <strong>pares compactados</strong> no padr√£o
  <code class="codeStyle">*_1.fastq.gz</code> e <code class="codeStyle">*_2.fastq.gz</code> dentro do diret√≥rio informado.
  Primeiro ela valida se o caminho existe e √© uma pasta; depois lista apenas os nomes que
  combinam com o sufixo <code class="codeStyle">_(1|2).fastq.gz</code>. Se n√£o houver nenhum arquivo nesse padr√£o,
  ela aborta. Caso haja arquivos, a fun√ß√£o extrai o ‚Äúprefixo base‚Äù
  (tudo antes de <code class="codeStyle">_(1|2).fastq.gz</code>) e verifica se <em>pelo menos um</em> desses
  prefixos possui o par completo (<code class="codeStyle">_1</code> e <code class="codeStyle">_2</code>). Se n√£o houver pares,
  aborta novamente. Se tudo estiver correto, retorna <code class="codeStyle"><em>true</em></code>
  e o workflow pode prosseguir (por exemplo, criando o canal com <code class="codeStyle">fromFilePairs</code>)
  sem ficar ‚Äúparado‚Äù por falta de entradas.
</p>

<pre>
// -------------------- Utils --------------------
// Verifica se existem pares *_1.fastq.gz e *_2.fastq.gz no diret√≥rio
def requireGzipPairs(String dirPath) {
  def dir = new File(dirPath)
  if (!dir.exists() || !dir.isDirectory())
    error "Diret√≥rio n√£o encontrado: ${dirPath}"

  def names = (dir.listFiles() ?: [])
      .collect { it.name }
      .findAll { it ==~ /.+_(1|2)\.fastq\.gz$/ }

  if (!names || names.isEmpty())
    error "Os arquivos t√™m que estar compactados (.fastq.gz) no padr√£o *_1.fastq.gz e *_2.fastq.gz em ${dirPath}."

  def bases = names.collect { it.replaceFirst(/_(1|2)\.fastq\.gz$/, '') }.unique()
  def hasPair = bases.any { base -&gt;
    new File(dir, "${base}_1.fastq.gz").exists() &amp;&amp; new File(dir, "${base}_2.fastq.gz").exists()
  }

  if (!hasPair)
    error "Arquivos .fastq.gz encontrados, mas **sem par** correspondente *_1/_2 em ${dirPath}."

  return true
}
</pre>

<h3>3.4 Processo DOWNLOAD_SRA</h3>

<p style="text-align: justify">
  Este processo recebe o identificador <code class="codeStyle">srr</code> e usa <code class="codeStyle">prefetch</code> para baixar o arquivo
  <span class="tooltip"><strong>.sra</strong><span class="tooltiptext">Arquivo bruto do SRA; cont√©m as leituras.</span></span>
  para o cache padr√£o do SRA-Tools. A sa√≠da √© o pr√≥prio <code class="codeStyle">srr</code> (valor simples), que segue para a pr√≥xima etapa.
</p>

<pre>
// 1) Prefetch (cache local do SRA); emite apenas o SRR para o pr√≥ximo passo
process DOWNLOAD_SRA {
  tag "${srr}"

  input:
  val srr

  output:
  val srr

  script:
  """
  prefetch ${srr}
  """
}
</pre>

<h3>3.4.1 Processo SRA_TO_FASTQ</h3>

<p style="text-align: justify">
  Converte o <code class="codeStyle">.sra</code> baixado em FASTQs com <code class="codeStyle">fasterq-dump</code> (dividindo em R1/R2 com
  <code class="codeStyle">--split-files</code>) e compacta os arquivos resultantes dando prefer√™ncia ao <code class="codeStyle">pigz</code>
  (paralelo) com <code class="codeStyle">gzip</code> como alternativa. A sa√≠da √© uma tupla <code class="codeStyle">(srr, arquivos)</code> em que
  <code class="codeStyle">arquivos</code> corresponde ao padr√£o <code class="codeStyle">"${'{'}srr{'}'}_*.fastq.gz"</code>, preservando a associa√ß√£o da amostra.
</p>

<pre>
// 2) Converter SRA -&gt; FASTQ(.gz) com fasterq-dump
process SRA_TO_FASTQ {
  tag "${srr}"

  input:
  val srr

  output:
  tuple val(srr), path("${srr}_*.fastq.gz")

  script:
  """
  # Gera FASTQs e compacta
  fasterq-dump ${srr} -O . --split-files
  pigz -f ${srr}_1.fastq || gzip -f ${srr}_1.fastq
  pigz -f ${srr}_2.fastq || gzip -f ${srr}_2.fastq || true
  """
}
</pre>

<h3>3.5 Processo FASTQC</h3>

<p style="text-align: justify">
  Recebe <code class="codeStyle">tuple val(srr), path(reads)</code>, onde <code class="codeStyle">reads</code> √© a lista com R1/R2 executa o <code class="codeStyle">fastqc</code> e publica os relat√≥rios por amostra em
  <code class="codeStyle">${'{'}params.outdir{'}'}/${'{'}srr{'}'}</code> usando <code class="codeStyle">publishDir</code>. Os artefatos gerados s√£o os arquivos
  <code class="codeStyle">.html</code> e <code class="codeStyle">.zip</code> do FastQC.
</p>

<pre>
// 3) FastQC ‚Äî recebe (srr, [R1,R2])
process FASTQC {
  tag "${srr}"

  publishDir { "${params.outdir}/${srr}" }, mode: 'copy', overwrite: true

  input:
  tuple val(srr), path(reads)

  output:
  path "*.html"
  path "*.zip"

  script:
  """
  fastqc -o . ${reads}
  """
}
</pre>

<h3>3.6 Workflow</h3>

<p style="text-align: justify">
  O <em>workflow</em> escolhe entre dois ramos de execu√ß√£o, conforme o par√¢metro informado.
  No modo <code class="codeStyle">--fastq</code>, ele registra o modo nos logs, faz uma verifica√ß√£o
  com <code class="codeStyle">requireGzipPairs(...)</code> para garantir a presen√ßa de pares <code class="codeStyle">*_1.fastq.gz</code> e
  <code class="codeStyle">*_2.fastq.gz</code>, cria um canal de pares com <code class="codeStyle">fromFilePairs</code> (emitindo
  <code class="codeStyle">(id, [R1,R2])</code>) e envia diretamente para o processo <code class="codeStyle">FASTQC</code>. 
  No modo <code class="codeStyle">--srr</code>, ele registra o SRR, cria um canal com o identificador, baixa o acesso
  com <code class="codeStyle">DOWNLOAD_SRA</code>, converte para FASTQ com <code class="codeStyle">SRA_TO_FASTQ</code> (emitindo
  <code class="codeStyle">(srr, &quot;${'{'}srr{'}'}_*.fastq.gz&quot;)</code>) e ent√£o executa o <code class="codeStyle">FASTQC</code>. 
  Se nenhum modo for fornecido (ou se houver conflito), o pipeline √© abortado.
  O coment√°rio no c√≥digo mostra, como refer√™ncia, como normalizar a sa√≠da caso voc√™ tenha um
  <code class="codeStyle">SRA_TO_FASTQ</code> que emita tr√™s campos (<code class="codeStyle">srr, r1, r2</code>) em vez de uma lista.
</p>

<pre>
// -------------------- Workflow --------------------
workflow {
  if (params.fastq) {
    log.info "Modo: FASTQ local"
    log.info "FASTQ dir: ${params.fastq}"

    // ---- Verifica√ß√£o de gzip ----
    requireGzipPairs(params.fastq as String)

    // S√≥ depois cria a channel:
    fastq_ch = Channel.fromFilePairs("${params.fastq}/*_{1,2}.fastq.gz")

    FASTQC(fastq_ch)
  }
  else if (params.srr) {
    log.info "Modo: SRA"
    log.info "Iniciando pipeline com SRR: ${params.srr}"

    srr_ch   = Channel.of(params.srr)
    cached   = DOWNLOAD_SRA(srr_ch)
    fastq_ch = SRA_TO_FASTQ(cached)

    FASTQC(fastq_ch)
  }
  else {
    error "Forne√ßa --fastq &lt;dir&gt; (FASTQ local) ou --srr &lt;ID&gt; (SRA). Use --help para ajuda."
  }
}
</pre>

<hr />

<h1 id="conclus√£o">Conclus√£o</h1>

<p style="text-align: justify">
Voc√™ instalou o <a class="badge badge--nextflow" href="https://www.nextflow.io/" target="_blank" rel="noopener">Nextflow</a>
e rodou seu primeiro workflow com FastQC usando ambiente <span class="badge badge--conda">Conda</span>.
Daqui para frente, √© s√≥ ir plugando novas etapas (ex.: TrimGalore!, BWA, Samtools, MultiQC) e deixar o <span class="badge badge--nextflow">Nextflow</span> orquestrar tudo com classe.
</p>

<p>At√© a pr√≥xima!</p>

<p><img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExd3hjbGViODEyaWVmdHlvc2ZqZW5ueDF6dWNqdTU0aGVqMXVhaXFmZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/DfbpTbQ9TvSX6/giphy.gif" alt="gif" width="200" style="display:block; margin:auto;" /></p>

<hr />

<p>Se curtiu, d√° aquele apoio no <a href="https://www.linkedin.com/in/christopher-lee-390643197/" target="_blank">LinkedIn</a> e considere um caf√©zinho ‚òï para manter o projeto vivo. Valeu!</p>

<p>Pix: <a href="mailto:biologolee@gmail.com">biologolee@gmail.com</a><br />
Bitcoin: bc1qg7qrfhclzt3sm60en53qv8fmwpuacfaxt5v55k</p>

<p><img src="/assets/img/meus_projetos/bluewallet_qrcode.png" alt="QR Code" /></p>

<h1 id="refer√™ncias">Refer√™ncias</h1>

<ol>
  <li><a href="https://www.nextflow.io/docs/latest/index.html" target="_blank">Documenta√ß√£o oficial do Nextflow</a></li>
  <li><a href="https://docs.conda.io/projects/conda/en/latest/index.html/" target="_blank">Conda</a></li>
</ol>

      </section>
    </section>
  </main>

  <button id="btn-top" aria-label="Voltar ao topo">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
      <path d="M12 4l-7 7h4v9h6v-9h4z"/>
    </svg>
    <span class="tooltip">Voltar ao topo</span>
  </button>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">¬© <span id="year"></span> Christopher William Lee ‚Äî Guias</div>
  </footer>
  
  <script src="/assets/js/main.js"></script>
</body>
</html>
